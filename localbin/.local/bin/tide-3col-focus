#!/usr/bin/env bash
# Resize panes in a tide 3col window on focus change.
# Usage: tide-3col-focus <focused_pane_id> <window_id>

focused="$1"
win="$2"

# Sort panes left-to-right by their horizontal position (mapfile requires bash 4+)
panes=()
while IFS= read -r p; do panes+=("$p"); done < <(
	tmux list-panes -t "$win" -F "#{pane_left} #{pane_id}" | sort -n | awk '{print $2}'
)

[ "${#panes[@]}" -ne 3 ] && exit 0

left="${panes[0]}"
mid="${panes[1]}"
right="${panes[2]}"

# Resize order matters: the "far" non-focused pane is resized first so its
# freed space flows into the adjacent pane, which then has room to donate to
# the focused pane when it expands. The mid pane is always set last among
# non-focused panes as cleanup.
if [ "$focused" = "$left" ]; then
	tmux resize-pane -t "$right" -x 25%
	tmux resize-pane -t "$left" -x 50%
	tmux resize-pane -t "$mid" -x 25%
elif [ "$focused" = "$right" ]; then
	tmux resize-pane -t "$left" -x 25%
	tmux resize-pane -t "$right" -x 50%
	tmux resize-pane -t "$mid" -x 25%
else
	tmux resize-pane -t "$left" -x 25%
	tmux resize-pane -t "$right" -x 25%
	tmux resize-pane -t "$mid" -x 50%
fi
